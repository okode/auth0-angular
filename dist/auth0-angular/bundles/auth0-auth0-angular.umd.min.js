!(function (t, e) {
  'object' == typeof exports && 'undefined' != typeof module
    ? e(
        exports,
        require('@angular/core'),
        require('rxjs'),
        require('rxjs/operators'),
        require('@auth0/auth0-spa-js'),
        require('@angular/common'),
        require('@angular/router')
      )
    : 'function' == typeof define && define.amd
    ? define('@auth0/auth0-angular', [
        'exports',
        '@angular/core',
        'rxjs',
        'rxjs/operators',
        '@auth0/auth0-spa-js',
        '@angular/common',
        '@angular/router',
      ], e)
    : e(
        (((t =
          'undefined' != typeof globalThis ? globalThis : t || self).auth0 =
          t.auth0 || {}),
        (t.auth0['auth0-angular'] = {})),
        t.ng.core,
        t.rxjs,
        t.rxjs.operators,
        t.i4,
        t.ng.common,
        t.ng.router
      );
})(this, function (t, e, n, r, i, o, u) {
  'use strict';
  /*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */ Object.create;
  Object.create;
  var a = '@auth0/auth0-angular',
    c = '1.3.2',
    s = (function () {
      function t() {}
      return (
        (t.createClient = function (t) {
          var e = t.get();
          if (!e)
            throw new Error(
              'Configuration must be specified either through AuthModule.forRoot or through AuthClientConfig.set'
            );
          var n = e.redirectUri,
            r = e.clientId,
            o = e.maxAge,
            u =
              (e.httpInterceptor,
              (function (t, e) {
                var n = {};
                for (var r in t)
                  Object.prototype.hasOwnProperty.call(t, r) &&
                    e.indexOf(r) < 0 &&
                    (n[r] = t[r]);
                if (
                  null != t &&
                  'function' == typeof Object.getOwnPropertySymbols
                ) {
                  var i = 0;
                  for (r = Object.getOwnPropertySymbols(t); i < r.length; i++)
                    e.indexOf(r[i]) < 0 &&
                      Object.prototype.propertyIsEnumerable.call(t, r[i]) &&
                      (n[r[i]] = t[r[i]]);
                }
                return n;
              })(e, ['redirectUri', 'clientId', 'maxAge', 'httpInterceptor']));
          return new i.Auth0Client(
            Object.assign(
              Object.assign(
                {
                  redirect_uri: n || window.location.origin,
                  client_id: r,
                  max_age: o,
                },
                u
              ),
              { auth0Client: { name: a, version: c } }
            )
          );
        }),
        t
      );
    })(),
    h = new e.InjectionToken('auth0.client');
  function f(t) {
    return void 0 !== t.uri;
  }
  var p = (function () {
    function t(t) {
      t && this.set(t);
    }
    return (
      (t.prototype.set = function (t) {
        this.config = t;
      }),
      (t.prototype.get = function () {
        return this.config;
      }),
      t
    );
  })();
  (p.ɵfac = function (t) {
    return new (t || p)(e.ɵɵinject(l, 8));
  }),
    (p.ɵprov = e.ɵɵdefineInjectable({
      token: p,
      factory: p.ɵfac,
      providedIn: 'root',
    }));
  var l = new e.InjectionToken('auth0-angular.config'),
    d = (function () {
      function t(t, e) {
        this.location = t;
        try {
          this.router = e.get(u.Router);
        } catch (t) {}
      }
      return (
        (t.prototype.navigateByUrl = function (t) {
          this.router
            ? this.router.navigateByUrl(t)
            : this.location.replaceState(t);
        }),
        t
      );
    })();
  (d.ɵfac = function (t) {
    return new (t || d)(e.ɵɵinject(o.Location), e.ɵɵinject(e.Injector));
  }),
    (d.ɵprov = e.ɵɵdefineInjectable({
      token: d,
      factory: d.ɵfac,
      providedIn: 'root',
    }));
  var g = (function () {
    function t(t, e, i, o) {
      var u = this;
      (this.auth0Client = t),
        (this.configFactory = e),
        (this.location = i),
        (this.navigator = o),
        (this.isLoadingSubject$ = new n.BehaviorSubject(!0)),
        (this.errorSubject$ = new n.ReplaySubject(1)),
        (this.refreshState$ = new n.Subject()),
        (this.ngUnsubscribe$ = new n.Subject()),
        (this.isLoading$ = this.isLoadingSubject$.asObservable()),
        (this.isAuthenticatedTrigger$ = this.isLoading$.pipe(
          r.filter(function (t) {
            return !t;
          }),
          r.distinctUntilChanged(),
          r.switchMap(function () {
            return n.merge(
              n.defer(function () {
                return u.auth0Client.isAuthenticated();
              }),
              u.refreshState$.pipe(
                r.mergeMap(function () {
                  return u.auth0Client.isAuthenticated();
                })
              )
            );
          })
        )),
        (this.isAuthenticated$ = this.isAuthenticatedTrigger$.pipe(
          r.distinctUntilChanged()
        )),
        (this.user$ = this.isAuthenticatedTrigger$.pipe(
          r.concatMap(function (t) {
            return t ? u.auth0Client.getUser() : n.of(null);
          })
        )),
        (this.idTokenClaims$ = this.isAuthenticatedTrigger$.pipe(
          r.concatMap(function (t) {
            return t ? u.auth0Client.getIdTokenClaims() : n.of(null);
          })
        )),
        (this.error$ = this.errorSubject$.asObservable());
      this.shouldHandleCallback()
        .pipe(
          r.switchMap(function (t) {
            return (function (t) {
              return n.iif(
                function () {
                  return t;
                },
                u.handleRedirectCallback(),
                n.defer(function () {
                  return u.auth0Client.checkSession();
                })
              );
            })(t).pipe(
              r.catchError(function (t) {
                var e = u.configFactory.get();
                return (
                  u.errorSubject$.next(t),
                  u.navigator.navigateByUrl(e.errorPath || '/'),
                  n.of(void 0)
                );
              })
            );
          }),
          r.tap(function () {
            u.isLoadingSubject$.next(!1);
          }),
          r.takeUntil(this.ngUnsubscribe$)
        )
        .subscribe();
    }
    return (
      (t.prototype.ngOnDestroy = function () {
        this.ngUnsubscribe$.next(), this.ngUnsubscribe$.complete();
      }),
      (t.prototype.loginWithRedirect = function (t) {
        return n.from(this.auth0Client.loginWithRedirect(t));
      }),
      (t.prototype.loginWithPopup = function (t, e) {
        var r = this;
        return n.from(
          this.auth0Client.loginWithPopup(t, e).then(function () {
            r.refreshState$.next();
          })
        );
      }),
      (t.prototype.logout = function (t) {
        this.auth0Client.logout(t),
          (null == t ? void 0 : t.localOnly) && this.refreshState$.next();
      }),
      (t.prototype.getAccessTokenSilently = function (t) {
        var e = this;
        return n.of(this.auth0Client).pipe(
          r.concatMap(function (e) {
            return e.getTokenSilently(t);
          }),
          r.tap(function () {
            return e.refreshState$.next();
          }),
          r.catchError(function (t) {
            return (
              e.errorSubject$.next(t), e.refreshState$.next(), n.throwError(t)
            );
          })
        );
      }),
      (t.prototype.getAccessTokenWithPopup = function (t) {
        var e = this;
        return n.of(this.auth0Client).pipe(
          r.concatMap(function (e) {
            return e.getTokenWithPopup(t);
          }),
          r.tap(function () {
            return e.refreshState$.next();
          }),
          r.catchError(function (t) {
            return (
              e.errorSubject$.next(t), e.refreshState$.next(), n.throwError(t)
            );
          })
        );
      }),
      (t.prototype.auth0HandleCallback = function (t) {
        var e = this;
        ((null == t ? void 0 : t.includes('code=')) ||
          (null == t ? void 0 : t.includes('error='))) &&
          (null == t ? void 0 : t.includes('state=')) &&
          n
            .from(this.auth0Client.handleRedirectCallback(t))
            .pipe(
              r.map(function (t) {
                var n = '/';
                t && t.appState && t.appState.target && (n = t.appState.target),
                  e.navigator.navigateByUrl(n);
              }),
              r.tap(function () {
                e.refreshState$.next(), e.isLoadingSubject$.next(!1);
              }),
              r.takeUntil(this.ngUnsubscribe$)
            )
            .subscribe();
      }),
      (t.prototype.shouldHandleCallback = function () {
        var t = this;
        return n.of(this.location.path()).pipe(
          r.map(function (e) {
            return (
              (e.includes('code=') || e.includes('error=')) &&
              e.includes('state=') &&
              !t.configFactory.get().skipRedirectCallback
            );
          })
        );
      }),
      (t.prototype.handleRedirectCallback = function () {
        var t = this;
        return n
          .defer(function () {
            return t.auth0Client.handleRedirectCallback();
          })
          .pipe(
            r.tap(function (e) {
              var n,
                r,
                i =
                  null !==
                    (r =
                      null === (n = null == e ? void 0 : e.appState) ||
                      void 0 === n
                        ? void 0
                        : n.target) && void 0 !== r
                    ? r
                    : '/';
              t.navigator.navigateByUrl(i);
            })
          );
      }),
      t
    );
  })();
  (g.ɵfac = function (t) {
    return new (t || g)(
      e.ɵɵinject(h),
      e.ɵɵinject(p),
      e.ɵɵinject(o.Location),
      e.ɵɵinject(d)
    );
  }),
    (g.ɵprov = e.ɵɵdefineInjectable({
      token: g,
      factory: g.ɵfac,
      providedIn: 'root',
    }));
  var v = (function () {
    function t(t) {
      this.auth = t;
    }
    return (
      (t.prototype.canLoad = function (t, e) {
        return this.auth.isAuthenticated$.pipe(r.take(1));
      }),
      (t.prototype.canActivate = function (t, e) {
        return this.redirectIfUnauthenticated(e);
      }),
      (t.prototype.canActivateChild = function (t, e) {
        return this.redirectIfUnauthenticated(e);
      }),
      (t.prototype.redirectIfUnauthenticated = function (t) {
        var e = this;
        return this.auth.isAuthenticated$.pipe(
          r.tap(function (r) {
            return r
              ? n.of(!0)
              : e.auth.loginWithRedirect({ appState: { target: t.url } });
          })
        );
      }),
      t
    );
  })();
  (v.ɵfac = function (t) {
    return new (t || v)(e.ɵɵinject(g));
  }),
    (v.ɵprov = e.ɵɵdefineInjectable({
      token: v,
      factory: v.ɵfac,
      providedIn: 'root',
    }));
  var b = (function () {
    function t() {}
    return (
      (t.forRoot = function (e) {
        return {
          ngModule: t,
          providers: [
            g,
            v,
            { provide: l, useValue: e },
            { provide: h, useFactory: s.createClient, deps: [p] },
          ],
        };
      }),
      t
    );
  })();
  (b.ɵmod = e.ɵɵdefineNgModule({ type: b })),
    (b.ɵinj = e.ɵɵdefineInjector({
      factory: function (t) {
        return new (t || b)();
      },
    }));
  var y = (function () {
    function t(t, e) {
      (this.configFactory = t), (this.authService = e);
    }
    return (
      (t.prototype.intercept = function (t, e) {
        var i,
          o = this,
          u = this.configFactory.get();
        return (
          null === (i = u.httpInterceptor) || void 0 === i
            ? void 0
            : i.allowedList
        )
          ? this.findMatchingRoute(t, u.httpInterceptor).pipe(
              r.concatMap(function (i) {
                return n.iif(
                  function () {
                    return null !== i;
                  },
                  n.of(i).pipe(
                    r.pluck('tokenOptions'),
                    r.concatMap(function (t) {
                      return o.authService.getAccessTokenSilently(t);
                    }),
                    r.switchMap(function (n) {
                      var r = t.clone({
                        headers: t.headers.set('Authorization', 'Bearer ' + n),
                      });
                      return e.handle(r);
                    })
                  ),
                  e.handle(t)
                );
              })
            )
          : e.handle(t);
      }),
      (t.prototype.stripQueryFrom = function (t) {
        return (
          t.indexOf('?') > -1 && (t = t.substr(0, t.indexOf('?'))),
          t.indexOf('#') > -1 && (t = t.substr(0, t.indexOf('#'))),
          t
        );
      }),
      (t.prototype.canAttachToken = function (t, e) {
        var n = this,
          r = function (t) {
            return (
              t && t.trim(),
              !!t &&
                (t === n.stripQueryFrom(e.url) ||
                  (t.indexOf('*') === t.length - 1 &&
                    e.url.startsWith(t.substr(0, t.length - 1))))
            );
          };
        return f(t)
          ? (!t.httpMethod || t.httpMethod === e.method) && r(t.uri)
          : r(t);
      }),
      (t.prototype.findMatchingRoute = function (t, e) {
        var i = this;
        return n.from(e.allowedList).pipe(
          r.first(function (e) {
            return i.canAttachToken(e, t);
          }, null)
        );
      }),
      t
    );
  })();
  (y.ɵfac = function (t) {
    return new (t || y)(e.ɵɵinject(p), e.ɵɵinject(g));
  }),
    (y.ɵprov = e.ɵɵdefineInjectable({ token: y, factory: y.ɵfac })),
    (t.AuthClientConfig = p),
    (t.AuthConfigService = l),
    (t.AuthGuard = v),
    (t.AuthHttpInterceptor = y),
    (t.AuthModule = b),
    (t.AuthService = g),
    (t.isHttpInterceptorRouteConfig = f),
    Object.defineProperty(t, '__esModule', { value: !0 });
});
//# sourceMappingURL=auth0-auth0-angular.umd.min.js.map
